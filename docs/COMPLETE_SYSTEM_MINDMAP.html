<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports_See Complete System Mind Map - All Steps & Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #764ba2;
            box-shadow: 0 5px 15px rgba(118, 75, 162, 0.4);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }

        .mindmap-container {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow-x: auto;
            max-height: 800px;
            overflow-y: auto;
        }

        .sidebar {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            height: fit-content;
            max-height: 800px;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            color: #667eea;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        .subsection {
            margin-left: 20px;
            margin-bottom: 20px;
        }

        .subsection-title {
            color: #764ba2;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            user-select: none;
        }

        .subsection-title:hover {
            color: #667eea;
        }

        .toggle-icon {
            display: inline-block;
            transition: transform 0.3s ease;
            font-size: 14px;
        }

        .subsection.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }

        .step-list {
            display: none;
            margin-left: 25px;
            margin-top: 10px;
        }

        .subsection.collapsed .step-list {
            display: none;
        }

        .subsection:not(.collapsed) .step-list {
            display: block;
        }

        .step {
            background: #f9f9f9;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .step:hover {
            background: #f0f4ff;
            border-left-color: #764ba2;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            font-size: 12px;
            font-weight: 600;
            margin-right: 8px;
        }

        .step-name {
            font-weight: 600;
            color: #333;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .step-description {
            color: #666;
            font-size: 12px;
            line-height: 1.5;
            margin-bottom: 6px;
        }

        .step-analysis {
            background: white;
            padding: 8px;
            border-radius: 3px;
            font-size: 11px;
            color: #555;
            margin-bottom: 4px;
            border-left: 2px solid #ffc107;
        }

        .step-analysis strong {
            color: #764ba2;
        }

        .decision-point {
            background: #fff3cd;
            border-left-color: #ffc107;
        }

        .decision-point .step-number {
            background: #ffc107;
        }

        .data-check {
            background: #e8f5e9;
            border-left-color: #4caf50;
        }

        .data-check .step-number {
            background: #4caf50;
        }

        .quality-metric {
            background: #f3e5f5;
            border-left-color: #9c27b0;
        }

        .quality-metric .step-number {
            background: #9c27b0;
        }

        .detail-panel {
            display: none;
            background: #f0f4ff;
            border: 2px solid #667eea;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
        }

        .step.active .detail-panel {
            display: block;
        }

        .detail-header {
            color: #667eea;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .detail-item {
            color: #555;
            font-size: 11px;
            margin-bottom: 6px;
            padding-left: 12px;
            position: relative;
        }

        .detail-item:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #764ba2;
            font-weight: bold;
        }

        .sidebar-section {
            margin-bottom: 20px;
        }

        .sidebar-title {
            color: #667eea;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 10px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .sidebar-item {
            background: #f9f9f9;
            padding: 8px;
            margin-bottom: 6px;
            border-radius: 4px;
            font-size: 11px;
            color: #555;
            border-left: 3px solid #667eea;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sidebar-item:hover {
            background: #f0f4ff;
            border-left-color: #764ba2;
        }

        .legend {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .legend-title {
            color: #667eea;
            font-weight: 600;
            font-size: 11px;
            margin-bottom: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 10px;
            margin-bottom: 4px;
            color: #666;
        }

        .legend-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 2px;
            border-left: 3px solid;
        }

        .color-process {
            border-left-color: #667eea;
            background: #e8eaf6;
        }

        .color-decision {
            border-left-color: #ffc107;
            background: #fff8e1;
        }

        .color-check {
            border-left-color: #4caf50;
            background: #e8f5e9;
        }

        .color-quality {
            border-left-color: #9c27b0;
            background: #f3e5f5;
        }

        .metrics-display {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 11px;
        }

        .metric-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 6px;
        }

        .metric-label {
            color: #666;
            font-weight: 500;
        }

        .metric-value {
            color: #764ba2;
            font-weight: 600;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .sidebar {
                max-height: none;
            }
        }

        .footer {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            text-align: center;
            color: #666;
            font-size: 12px;
        }

        .hidden {
            display: none;
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .view-btn {
            padding: 8px 14px;
            background: #f0f4ff;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: #667eea;
            color: white;
        }

        .view-btn:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Sports_See Complete System Mind Map</h1>
            <p>
                Interactive visualization of every step, analysis, decision point, and quality check
                in the Sports_See RAG system - from data ingestion through query processing to response generation.
            </p>
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showView('overview')">Overview</button>
                <button class="nav-btn" onclick="showView('data-pipeline')">üìä Data Pipeline</button>
                <button class="nav-btn" onclick="showView('rag-pipeline')">üîç RAG Query Pipeline</button>
                <button class="nav-btn" onclick="showView('analysis')">üìà All Analyses</button>
                <button class="nav-btn" onclick="showView('decisions')">üéØ Decision Points</button>
            </div>
        </div>

        <div class="main-content">
            <div class="mindmap-container" id="mindmapContainer">
                <!-- OVERVIEW TAB -->
                <div id="overview-tab" class="view-tab active">
                    <div class="section">
                        <div class="section-title">üèóÔ∏è System Architecture Overview</div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Phase 1: Data Preparation (Once during Setup)
                            </div>
                            <div class="step-list">
                                <div class="step data-check">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üì• Load Source Documents</div>
                                    <div class="step-description">Read PDFs and Excel files from data/inputs/</div>
                                    <div class="step-analysis"><strong>File Analysis:</strong> Format detection, encoding validation, file size checks</div>
                                </div>
                                <div class="step data-check">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üîÑ Extract & Preprocess Content</div>
                                    <div class="step-description">OCR for PDFs, parse Excel sheets, clean text</div>
                                    <div class="step-analysis"><strong>Content Quality:</strong> Text coherence, character encoding, metadata extraction</div>
                                </div>
                                <div class="step data-check">
                                    <div class="step-number">3</div>
                                    <div class="step-name">‚úÇÔ∏è Chunk Documents</div>
                                    <div class="step-description">Split into semantic chunks using RedditThreadChunker (domain-aware)</div>
                                    <div class="step-analysis"><strong>Chunking Metrics:</strong> Chunk size, overlap, semantic coherence, structure preservation</div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">4</div>
                                    <div class="step-name">‚≠ê Phase 3 Step 1: Document Quality Assessment</div>
                                    <div class="step-description">Score document quality (text coherence, metadata, Reddit authority)</div>
                                    <div class="step-analysis"><strong>Quality Scoring:</strong> Coherence score, metadata completeness, source authority (0-1 scale)</div>
                                </div>
                                <div class="step data-check">
                                    <div class="step-number">5</div>
                                    <div class="step-name">üî¢ Vectorize & Index (FAISS)</div>
                                    <div class="step-description">Convert chunks to embeddings using Mistral, build FAISS index</div>
                                    <div class="step-analysis"><strong>Vector Metrics:</strong> Embedding dimension (1024D), index type, similarity distribution</div>
                                </div>
                                <div class="step data-check">
                                    <div class="step-number">6</div>
                                    <div class="step-name">üíæ Store SQL Database</div>
                                    <div class="step-description">Import NBA stats and reference data into SQLite</div>
                                    <div class="step-analysis"><strong>Database Validation:</strong> Record counts, schema integrity, index efficiency</div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Phase 2: Query Processing (Per User Query)
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üì® Receive Query from UI</div>
                                    <div class="step-description">User enters question in Streamlit interface</div>
                                    <div class="step-analysis"><strong>Input Validation:</strong> Length check, character validation, encoding verification</div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üí¨ Check Conversation Context</div>
                                    <div class="step-description">Load previous messages if follow-up query detected</div>
                                    <div class="step-analysis"><strong>Context Analysis:</strong> Follow-up indicators (pronouns, references), context window size</div>
                                </div>
                                <div class="step decision-point">
                                    <div class="step-number">3</div>
                                    <div class="step-name">üéØ Query Classification</div>
                                    <div class="step-description">Classify query type: SQL, Contextual, or Hybrid with confidence scoring</div>
                                    <div class="step-analysis">
                                        <strong>Classification Signals:</strong>
                                        <br/>‚Ä¢ Pattern matching (definitional, stats, glossary)
                                        <br/>‚Ä¢ LLM classification with confidence
                                        <br/>‚Ä¢ Threshold routing (‚â•80%‚ÜíSQL, ‚â•75%‚ÜíContextual, 50-70%‚ÜíHybrid, &lt;50%‚Üífallback)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Phase 3: Optimizations & Enhancements
                            </div>
                            <div class="step-list">
                                <div class="step quality-metric">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üèÜ Step 1: Quality Filtering</div>
                                    <div class="step-description">Filter low-quality documents at query time based on scores</div>
                                    <div class="step-analysis"><strong>Filter Logic:</strong> Coherence ‚â•0.7, metadata score ‚â•0.6, authority threshold applied</div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üìä Step 2: Recall-Aware K Selection</div>
                                    <div class="step-description">Adaptive K value based on query complexity and category</div>
                                    <div class="step-analysis"><strong>K Calculation:</strong> Base K + complexity bonus, category-specific adjustments (3-20 range)</div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">3</div>
                                    <div class="step-name">üîÑ Step 3: Category-Aware Query Expansion</div>
                                    <div class="step-description">Smart expansion for contextual/complex queries</div>
                                    <div class="step-analysis"><strong>Expansion Strategy:</strong> Synonym addition, entity extraction, relationship expansion</div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">4</div>
                                    <div class="step-name">üìù Step 4: Complex Query Context Formatting</div>
                                    <div class="step-description">Structured formatting for LLM comprehension</div>
                                    <div class="step-analysis"><strong>Format Rules:</strong> Numbered list (SQL data), bullet format (single), result count headers, 20-result limit</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DATA PIPELINE TAB -->
                <div id="data-pipeline-tab" class="view-tab hidden">
                    <div class="section">
                        <div class="section-title">üìä Data Pipeline - From Raw Documents to Indexes</div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Step 1: Document Loading & Format Detection
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Read PDFs (easyOCR)</div>
                                    <div class="step-description">Extract text from sports PDFs with optical character recognition</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Page count detection
                                        <br/>‚Ä¢ OCR confidence scores
                                        <br/>‚Ä¢ French accent preservation
                                        <br/>‚Ä¢ Text region extraction (80 regions/page typical)
                                        <br/>‚Ä¢ Unicode character validation
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/data/data_loader.py</div>
                                        <div class="detail-item">Lazy-loaded to avoid FAISS+torch AVX2 crash</div>
                                        <div class="detail-item">Output: List of text strings per PDF</div>
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Parse Excel Sheets</div>
                                    <div class="step-description">Read NBA statistics and reference data from Excel</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Column type detection (numeric, categorical, date)
                                        <br/>‚Ä¢ Missing value analysis
                                        <br/>‚Ä¢ Duplicate row detection
                                        <br/>‚Ä¢ Sheet structure validation
                                        <br/>‚Ä¢ Filter: Exclude structured data (use SQL instead, not vector)
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/data/data_loader.py (EXCLUDED_EXCEL_SHEETS)</div>
                                        <div class="detail-item">Reduced vectorization: 159 ‚Üí 5 chunks (97% reduction)</div>
                                        <div class="detail-item">Output: Dictionary of DataFrames</div>
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Text Cleaning & Normalization</div>
                                    <div class="step-description">Remove noise, normalize encoding, format text</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Remove HTML/XML tags
                                        <br/>‚Ä¢ Normalize whitespace
                                        <br/>‚Ä¢ Handle special characters (√©, √ß, etc)
                                        <br/>‚Ä¢ Remove control characters
                                        <br/>‚Ä¢ Validate UTF-8 encoding
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/data/pipeline.py</div>
                                        <div class="detail-item">Uses Path.write_text(encoding="utf-8") for Windows compat</div>
                                        <div class="detail-item">Output: Clean, normalized text</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Step 2: Chunking Strategy
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Domain-Aware Chunking (RedditThreadChunker)</div>
                                    <div class="step-description">Split documents at semantic boundaries, not random positions</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Thread/comment boundary detection
                                        <br/>‚Ä¢ Author/timestamp preservation
                                        <br/>‚Ä¢ Metadata extraction (Reddit karma, replies)
                                        <br/>‚Ä¢ Chunk coherence scoring
                                        <br/>‚Ä¢ Context relevance measurement
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/data/pipeline.py (RedditThreadChunker class)</div>
                                        <div class="detail-item">Why: Preserves Reddit discussion context vs generic chunking</div>
                                        <div class="detail-item">Output: List of Chunk objects with metadata</div>
                                    </div>
                                </div>

                                <div class="step quality-metric">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üìä Phase 3 Step 1: Document Quality Assessment</div>
                                    <div class="step-description">Score each chunk for coherence and metadata quality</div>
                                    <div class="step-analysis">
                                        <strong>Quality Metrics (0-1 scale):</strong>
                                        <br/>‚Ä¢ Text Coherence: Sentence structure quality
                                        <br/>‚Ä¢ Metadata Completeness: Author, timestamp, source present
                                        <br/>‚Ä¢ Reddit Authority: Karma score normalization
                                        <br/>‚Ä¢ Combined Score: Used for filtering at query time
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/repositories/vector_store.py (_assess_document_quality)</div>
                                        <div class="detail-item">Applied at: Query time (not ingestion) for flexibility</div>
                                        <div class="detail-item">Output: scores stored with chunks</div>
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Chunk Size & Overlap Optimization</div>
                                    <div class="step-description">Configure chunk size and overlap percentage</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Optimal chunk size: ~500-1500 tokens
                                        <br/>‚Ä¢ Overlap percentage: 10-20% for context
                                        <br/>‚Ä¢ Token count per chunk
                                        <br/>‚Ä¢ Overlap relevance validation
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/core/config.py</div>
                                        <div class="detail-item">Configured for Reddit discussions: favor context over brevity</div>
                                        <div class="detail-item">Output: Final chunks ready for vectorization</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Step 3: Vectorization & Indexing
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Generate Embeddings (Mistral)</div>
                                    <div class="step-description">Convert text chunks to 1024-D vectors</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Embedding model: mistral-embed (1024 dimensions)
                                        <br/>‚Ä¢ Vector normalization check
                                        <br/>‚Ä¢ Embedding quality validation
                                        <br/>‚Ä¢ Token count verification (‚â§512 token limit)
                                        <br/>‚Ä¢ Batch processing efficiency
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/repositories/vector_store.py</div>
                                        <div class="detail-item">Lazy-import ragas to avoid pyarrow compatibility crash</div>
                                        <div class="detail-item">Output: Vector array (N_chunks √ó 1024)</div>
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Build FAISS Index</div>
                                    <div class="step-description">Create searchable vector index with L2 distance metric</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Index type: Flat (exact search)
                                        <br/>‚Ä¢ Metric: L2 Euclidean distance
                                        <br/>‚Ä¢ Index size: Total vector memory
                                        <br/>‚Ä¢ Search speed benchmarks
                                        <br/>‚Ä¢ Index health validation
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/repositories/vector_store.py</div>
                                        <div class="detail-item">Serialized to data/vector/faiss_index.bin</div>
                                        <div class="detail-item">Output: Searchable FAISS index</div>
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Metadata Storage (Pickle)</div>
                                    <div class="step-description">Store chunk text and metadata separately</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Chunk text preservation
                                        <br/>‚Ä¢ Metadata dictionary validation
                                        <br/>‚Ä¢ Source attribution tracking
                                        <br/>‚Ä¢ Quality scores storage
                                        <br/>‚Ä¢ File integrity verification
                                    </div>
                                    <div class="detail-panel">
                                        <div class="detail-header">üìå Implementation Details</div>
                                        <div class="detail-item">File: src/repositories/vector_store.py</div>
                                        <div class="detail-item">Serialized to data/vector/chunks_metadata.pkl</div>
                                        <div class="detail-item">Output: Indexable chunk metadata</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Step 4: SQL Database Population
                            </div>
                            <div class="step-list">
                                <div class="step data-check">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Schema Validation</div>
                                    <div class="step-description">Verify database schema matches expected structure</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Table existence: players, player_stats, teams, seasons
                                        <br/>‚Ä¢ Column name validation
                                        <br/>‚Ä¢ Data type verification
                                        <br/>‚Ä¢ Constraint validation (PRIMARY KEY, FOREIGN KEY)
                                    </div>
                                </div>

                                <div class="step data-check">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Data Integrity Checks</div>
                                    <div class="step-description">Validate data quality before insertion</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Record count per table
                                        <br/>‚Ä¢ Null value analysis
                                        <br/>‚Ä¢ Duplicate detection
                                        <br/>‚Ä¢ Date range validation
                                        <br/>‚Ä¢ Numeric range checks (e.g., scores 0-150)
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Index Creation</div>
                                    <div class="step-description">Create database indexes for query performance</div>
                                    <div class="step-analysis">
                                        <strong>Analysis Performed:</strong>
                                        <br/>‚Ä¢ Index on player names (for quick lookup)
                                        <br/>‚Ä¢ Index on seasons (for time-based queries)
                                        <br/>‚Ä¢ Index on statistics columns (scoring, rebounds)
                                        <br/>‚Ä¢ Query plan analysis
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- RAG PIPELINE TAB -->
                <div id="rag-pipeline-tab" class="view-tab hidden">
                    <div class="section">
                        <div class="section-title">üîç RAG Query Pipeline - Per User Query</div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Stage 1: Query Reception & Validation
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üì® Receive from Streamlit UI</div>
                                    <div class="step-description">User submits question via text input</div>
                                    <div class="step-analysis">
                                        <strong>Validation Checks:</strong>
                                        <br/>‚Ä¢ Length: 5-1000 characters
                                        <br/>‚Ä¢ Character validation (ASCII + accented chars)
                                        <br/>‚Ä¢ Encoding detection (UTF-8 verified)
                                        <br/>‚Ä¢ Null/empty check
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üí¨ Load Conversation Context</div>
                                    <div class="step-description">Retrieve previous messages if follow-up query</div>
                                    <div class="step-analysis">
                                        <strong>Context Detection:</strong>
                                        <br/>‚Ä¢ Follow-up indicators: pronouns (he/she/they), references
                                        <br/>‚Ä¢ Context window size (last N messages)
                                        <br/>‚Ä¢ Conversation ID validation
                                        <br/>‚Ä¢ Message ordering verification
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Stage 2: Query Classification (Decision Point)
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üéØ Pattern-Based Preliminary Classification</div>
                                    <div class="step-description">Quick pattern matching for obvious query types</div>
                                    <div class="step-analysis">
                                        <strong>Patterns Detected:</strong>
                                        <br/>‚Ä¢ Definitional: "What is", "Define", "Explain"
                                        <br/>‚Ä¢ Glossary: "Meaning of", "What does", "Abbreviation"
                                        <br/>‚Ä¢ Statistical: "How many", "Top", "Average", "Most"
                                        <br/>‚Ä¢ Confidence: 0-1 for each classification
                                    </div>
                                </div>

                                <div class="step decision-point">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üß† LLM-Based Classification</div>
                                    <div class="step-description">Use Gemini to classify query type with confidence</div>
                                    <div class="step-analysis">
                                        <strong>Classification Output:</strong>
                                        <br/>‚Ä¢ Type: SQL_ONLY, CONTEXTUAL, HYBRID, or UNCERTAIN
                                        <br/>‚Ä¢ Confidence: 0.0-1.0 score
                                        <br/>‚Ä¢ Reasoning: Why this classification
                                        <br/>‚Ä¢ Alternative interpretations (top 2)
                                    </div>
                                </div>

                                <div class="step decision-point">
                                    <div class="step-number">3</div>
                                    <div class="step-name">üö¶ Routing Decision Logic</div>
                                    <div class="step-description">Apply confidence thresholds to decide routing</div>
                                    <div class="step-analysis">
                                        <strong>Routing Thresholds:</strong>
                                        <br/>‚Ä¢ SQL_ONLY: confidence ‚â• 0.80 ‚Üí Generate SQL
                                        <br/>‚Ä¢ CONTEXTUAL: confidence 0.75-0.79 ‚Üí Vector search
                                        <br/>‚Ä¢ HYBRID: confidence 0.50-0.74 ‚Üí Both SQL + Vector
                                        <br/>‚Ä¢ UNCERTAIN: confidence &lt; 0.50 ‚Üí Vector search + fallback
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Stage 3: Query Enhancement (Phase 3)
                            </div>
                            <div class="step-list">
                                <div class="step quality-metric">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üìù Estimate Recall Requirement</div>
                                    <div class="step-description">Determine how many sources needed for comprehensive answer</div>
                                    <div class="step-analysis">
                                        <strong>Recall Analysis:</strong>
                                        <br/>‚Ä¢ Query complexity: simple/moderate/complex/very_complex
                                        <br/>‚Ä¢ Category type: statistical/contextual/comparative
                                        <br/>‚Ä¢ Base K value: 5 (default)
                                        <br/>‚Ä¢ Complexity bonus: +2-5 for complex queries
                                        <br/>‚Ä¢ Final K: 3-20 range
                                    </div>
                                </div>

                                <div class="step quality-metric">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üîÑ Category-Aware Query Expansion</div>
                                    <div class="step-description">Expand query with synonyms and related terms</div>
                                    <div class="step-analysis">
                                        <strong>Expansion Strategy:</strong>
                                        <br/>‚Ä¢ Synonym extraction (e.g., "efficient" ‚Üí "PPG/FG%")
                                        <br/>‚Ä¢ Entity expansion (e.g., "LeBron" ‚Üí "James", "King James")
                                        <br/>‚Ä¢ Relationship expansion (e.g., "shooting" ‚Üí "FG%, 3P%, FT%")
                                        <br/>‚Ä¢ Category-specific rules by query type
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">‚úÇÔ∏è Document Quality Filtering</div>
                                    <div class="step-description">Filter documents below quality threshold</div>
                                    <div class="step-analysis">
                                        <strong>Filtering Rules:</strong>
                                        <br/>‚Ä¢ Min coherence score: 0.70
                                        <br/>‚Ä¢ Min metadata score: 0.60
                                        <br/>‚Ä¢ Authority threshold applied (Reddit karma)
                                        <br/>‚Ä¢ Maintain at least K results after filtering
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Stage 4: SQL Branch (if SQL_ONLY or Hybrid)
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üîß SQL Generation with LLM</div>
                                    <div class="step-description">Generate SQL query from natural language</div>
                                    <div class="step-analysis">
                                        <strong>Generation Analysis:</strong>
                                        <br/>‚Ä¢ Generated SQL text capture
                                        <br/>‚Ä¢ Syntax validation (SQLPARSE)
                                        <br/>‚Ä¢ Query complexity assessment (JOINs, aggregations)
                                        <br/>‚Ä¢ Table/column reference validation
                                        <br/>‚Ä¢ Security check (injection prevention)
                                    </div>
                                </div>

                                <div class="step decision-point">
                                    <div class="step-number">2</div>
                                    <div class="step-name">‚öôÔ∏è Execute SQL & Analyze Results</div>
                                    <div class="step-description">Run query and capture results for analysis</div>
                                    <div class="step-analysis">
                                        <strong>Result Analysis:</strong>
                                        <br/>‚Ä¢ Execution time measurement
                                        <br/>‚Ä¢ Result row count
                                        <br/>‚Ä¢ Data shape validation
                                        <br/>‚Ä¢ Result formatting: numbered list for LLM
                                        <br/>‚Ä¢ Top 20 results limit
                                    </div>
                                </div>

                                <div class="step decision-point">
                                    <div class="step-number">3</div>
                                    <div class="step-name">üîÑ Fallback Logic</div>
                                    <div class="step-description">Fallback to vector search if SQL fails or returns empty</div>
                                    <div class="step-analysis">
                                        <strong>Fallback Triggers:</strong>
                                        <br/>‚Ä¢ SQL Syntax Error ‚Üí Vector search
                                        <br/>‚Ä¢ SQL Execution Error ‚Üí Vector search
                                        <br/>‚Ä¢ Empty Results (0 rows) ‚Üí Vector search
                                        <br/>‚Ä¢ Retry count: max 1 fallback attempt
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-name">üìä Format for LLM Comprehension</div>
                                    <div class="step-description">Prepare SQL results in format LLM understands best</div>
                                    <div class="step-analysis">
                                        <strong>Formatting Rules:</strong>
                                        <br/>‚Ä¢ Header: "Found N matching records:"
                                        <br/>‚Ä¢ Format: Numbered list "1. name: X, pts: Y"
                                        <br/>‚Ä¢ Context: Include result count
                                        <br/>‚Ä¢ Limit: Top 20 results to avoid context overflow
                                        <br/>‚Ä¢ Language: Always English (no mixed headers)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Stage 5: Vector Search Branch (if Contextual or Hybrid)
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üîç Retrieve Similar Documents</div>
                                    <div class="step-description">Find K most similar chunks using FAISS</div>
                                    <div class="step-analysis">
                                        <strong>Retrieval Metrics:</strong>
                                        <br/>‚Ä¢ K value: 3-20 based on phase 3 estimation
                                        <br/>‚Ä¢ Similarity scores: 0-100%
                                        <br/>‚Ä¢ Score distribution analysis
                                        <br/>‚Ä¢ Retrieved chunk count
                                        <br/>‚Ä¢ Source diversity (# unique sources)
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">‚öñÔ∏è Hybrid Scoring (Phase 2)</div>
                                    <div class="step-description">Combine cosine, BM25, and metadata scores</div>
                                    <div class="step-analysis">
                                        <strong>Score Weights:</strong>
                                        <br/>‚Ä¢ Cosine Similarity: 50%
                                        <br/>‚Ä¢ BM25 (keyword matching): 35%
                                        <br/>‚Ä¢ Metadata Relevance: 15%
                                        <br/>‚Ä¢ Final Score: Weighted combination (0-100)
                                    </div>
                                </div>

                                <div class="step quality-metric">
                                    <div class="step-number">3</div>
                                    <div class="step-name">üèÜ Apply Quality Filters</div>
                                    <div class="step-description">Remove low-quality documents from results</div>
                                    <div class="step-analysis">
                                        <strong>Filter Thresholds:</strong>
                                        <br/>‚Ä¢ Coherence score ‚â• 0.70
                                        <br/>‚Ä¢ Metadata completeness ‚â• 0.60
                                        <br/>‚Ä¢ Min result requirement: Keep at least K results
                                        <br/>‚Ä¢ Preserve top sources even if below threshold
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-name">üìã Format Sources for Output</div>
                                    <div class="step-description">Prepare source information for UI display</div>
                                    <div class="step-analysis">
                                        <strong>Source Information:</strong>
                                        <br/>‚Ä¢ Source name/document
                                        <br/>‚Ä¢ Similarity score display (%)
                                        <br/>‚Ä¢ Document excerpt preview
                                        <br/>‚Ä¢ Author/timestamp (if available)
                                        <br/>‚Ä¢ Link/reference (if applicable)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Stage 6: LLM Response Generation & Synthesis
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üß† Synthesize Response</div>
                                    <div class="step-description">Generate final answer using LLM (Gemini)</div>
                                    <div class="step-analysis">
                                        <strong>Synthesis Analysis:</strong>
                                        <br/>‚Ä¢ Input context: SQL results + vector sources
                                        <br/>‚Ä¢ System prompt: Language, style, tone
                                        <br/>‚Ä¢ Response length: ~500-1500 characters typical
                                        <br/>‚Ä¢ Citation generation: Which sources used
                                        <br/>‚Ä¢ Completeness assessment
                                    </div>
                                </div>

                                <div class="step quality-metric">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üìù Phase 3 Step 4: Context Formatting</div>
                                    <div class="step-description">Structure complex query context for LLM understanding</div>
                                    <div class="step-analysis">
                                        <strong>Formatting for LLM:</strong>
                                        <br/>‚Ä¢ SQL data: Numbered list format
                                        <br/>‚Ä¢ Vector data: Bullet point format
                                        <br/>‚Ä¢ Result count header
                                        <br/>‚Ä¢ Language consistency (always English)
                                        <br/>‚Ä¢ Context window optimization
                                    </div>
                                </div>

                                <div class="step decision-point">
                                    <div class="step-number">3</div>
                                    <div class="step-name">ü§î Response Quality Check</div>
                                    <div class="step-description">Validate response meets quality standards</div>
                                    <div class="step-analysis">
                                        <strong>Quality Checks:</strong>
                                        <br/>‚Ä¢ Response length ‚â• 50 chars (not empty)
                                        <br/>‚Ä¢ No "cannot find" pattern (LLM declined)
                                        <br/>‚Ä¢ Confidence level assessment
                                        <br/>‚Ä¢ Citation presence check
                                        <br/>‚Ä¢ Language correctness (English)
                                    </div>
                                </div>

                                <div class="step decision-point">
                                    <div class="step-number">4</div>
                                    <div class="step-name">üîÑ Secondary Fallback (Vector if SQL said "not found")</div>
                                    <div class="step-description">Retry with vector search if LLM couldn't answer from SQL</div>
                                    <div class="step-analysis">
                                        <strong>Retry Logic:</strong>
                                        <br/>‚Ä¢ Pattern detection: "I cannot find" responses
                                        <br/>‚Ä¢ Trigger fallback: Switch to vector-only
                                        <br/>‚Ä¢ Retry count: Max 1 additional attempt
                                        <br/>‚Ä¢ Success rate tracking
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Stage 7: Output & Storage
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">üì§ Format Response for UI</div>
                                    <div class="step-description">Prepare response, sources, and metadata for display</div>
                                    <div class="step-analysis">
                                        <strong>Output Package:</strong>
                                        <br/>‚Ä¢ Response text (clean markdown)
                                        <br/>‚Ä¢ Source list with scores
                                        <br/>‚Ä¢ Processing time (ms)
                                        <br/>‚Ä¢ Confidence indicators
                                        <br/>‚Ä¢ Routing path taken (SQL/Vector/Both)
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">üíæ Log Interaction</div>
                                    <div class="step-description">Store query, response, and sources in database</div>
                                    <div class="step-analysis">
                                        <strong>Logged Data:</strong>
                                        <br/>‚Ä¢ Query text
                                        <br/>‚Ä¢ Response text
                                        <br/>‚Ä¢ Sources (up to 5)
                                        <br/>‚Ä¢ Processing time
                                        <br/>‚Ä¢ Conversation ID
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">üìä Collect Feedback</div>
                                    <div class="step-description">Track user feedback (thumbs up/down + comments)</div>
                                    <div class="step-analysis">
                                        <strong>Feedback Tracking:</strong>
                                        <br/>‚Ä¢ Positive/negative rating
                                        <br/>‚Ä¢ User comments (optional)
                                        <br/>‚Ä¢ Response quality indicators
                                        <br/>‚Ä¢ Used for evaluation datasets
                                    </div>
                                </div>

                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-name">üì± Render in Streamlit UI</div>
                                    <div class="step-description">Display response and interactive elements to user</div>
                                    <div class="step-analysis">
                                        <strong>UI Rendering:</strong>
                                        <br/>‚Ä¢ Response text with formatting
                                        <br/>‚Ä¢ Expandable sources panel
                                        <br/>‚Ä¢ Source similarity scores
                                        <br/>‚Ä¢ Feedback buttons
                                        <br/>‚Ä¢ Processing time display
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ANALYSIS TAB -->
                <div id="analysis-tab" class="view-tab hidden">
                    <div class="section">
                        <div class="section-title">üìà All Analyses Performed in the System</div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Data Pipeline Analyses
                            </div>
                            <div class="step-list">
                                <div class="step quality-metric">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Document Quality Assessment</div>
                                    <div class="step-description">Phase 3 Step 1: Score documents at query time</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Coherence (0-1), Metadata Score (0-1), Authority (0-1)
                                        <br/><strong>Files:</strong> src/repositories/vector_store.py
                                        <br/><strong>Usage:</strong> Filter low-quality documents during retrieval
                                    </div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Chunk Coherence Analysis</div>
                                    <div class="step-description">Assess semantic coherence within chunks</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Sentence structure quality, semantic continuity
                                        <br/><strong>Files:</strong> src/data/pipeline.py
                                        <br/><strong>Usage:</strong> Identify well-formed chunks vs noisy text
                                    </div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Metadata Extraction & Validation</div>
                                    <div class="step-description">Extract and validate document metadata</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Author presence, timestamp format, source completeness
                                        <br/><strong>Files:</strong> src/data/pipeline.py (RedditThreadChunker)
                                        <br/><strong>Usage:</strong> Populate metadata scores for quality assessment
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-name">Embedding Quality Check</div>
                                    <div class="step-description">Validate vector embeddings for consistency</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Vector dimensionality (1024D), normalization status
                                        <br/><strong>Files:</strong> src/repositories/vector_store.py
                                        <br/><strong>Usage:</strong> Ensure FAISS index contains valid vectors
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Query Classification Analyses
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Pattern Recognition Analysis</div>
                                    <div class="step-description">Detect query type via keyword patterns</div>
                                    <div class="step-analysis">
                                        <strong>Patterns:</strong> "What is" (definitional), "How many" (statistical), etc.
                                        <br/><strong>Metrics:</strong> Pattern match confidence (0-1)
                                        <br/><strong>Files:</strong> src/services/query_classifier.py
                                    </div>
                                </div>
                                <div class="step decision-point">
                                    <div class="step-number">2</div>
                                    <div class="step-name">LLM-Based Classification</div>
                                    <div class="step-description">Use Gemini to classify query with confidence</div>
                                    <div class="step-analysis">
                                        <strong>Output:</strong> Type (SQL/CONTEXTUAL/HYBRID), confidence (0-1), reasoning
                                        <br/><strong>Metrics:</strong> Classification accuracy (vs ground truth)
                                        <br/><strong>Files:</strong> src/services/query_classifier.py
                                    </div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Follow-Up Context Detection</div>
                                    <div class="step-description">Identify follow-up queries needing context</div>
                                    <div class="step-analysis">
                                        <strong>Indicators:</strong> Pronouns (he/she/they), references ("him", "that")
                                        <br/><strong>Metrics:</strong> Context window size, relevance
                                        <br/><strong>Files:</strong> src/services/chat.py
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                SQL Generation & Execution Analyses
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">SQL Query Structure Analysis</div>
                                    <div class="step-description">Analyze complexity of generated SQL</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> JOIN count, WHERE conditions, GROUP BY, subqueries
                                        <br/><strong>Complexity Levels:</strong> Simple/Moderate/Complex/Very Complex
                                        <br/><strong>Files:</strong> src/evaluation/analysis/sql_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">SQL Syntax Validation</div>
                                    <div class="step-description">Check SQL for syntax errors</div>
                                    <div class="step-analysis">
                                        <strong>Validation:</strong> SQLPARSE check, schema validation
                                        <br/><strong>Output:</strong> Valid/Invalid status, error messages
                                        <br/><strong>Files:</strong> src/tools/sql_tool.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Column Selection Analysis</div>
                                    <div class="step-description">Assess whether correct columns selected</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Column count, SELECT * usage, over/under-selection
                                        <br/><strong>Rates:</strong> % over-selected, % under-selected
                                        <br/><strong>Files:</strong> src/evaluation/analysis/sql_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-name">JOIN Correctness Analysis</div>
                                    <div class="step-description">Verify JOINs match schema relationships</div>
                                    <div class="step-analysis">
                                        <strong>Checks:</strong> Correct vs Missing JOINs
                                        <br/><strong>Example:</strong> players + player_stats requires JOIN
                                        <br/><strong>Files:</strong> src/evaluation/analysis/sql_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">5</div>
                                    <div class="step-name">Query Execution Time Analysis</div>
                                    <div class="step-description">Measure database query performance</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Execution time (ms), response row count
                                        <br/><strong>Thresholds:</strong> Slow query detection (&gt;5s)
                                        <br/><strong>Files:</strong> src/tools/sql_tool.py
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Vector Retrieval & Scoring Analyses
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Retrieval Performance Analysis</div>
                                    <div class="step-description">Analyze vector search results quality</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Avg similarity score, score distribution
                                        <br/><strong>Analysis:</strong> Gap between top/bottom scores, score thresholds
                                        <br/><strong>Files:</strong> src/evaluation/analysis/vector_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Hybrid Scoring Analysis (Phase 2)</div>
                                    <div class="step-description">Analyze weighted combination of 3 scoring signals</div>
                                    <div class="step-analysis">
                                        <strong>Weights:</strong> Cosine 50%, BM25 35%, Metadata 15%
                                        <br/><strong>Output:</strong> Final score (0-100%), contribution analysis
                                        <br/><strong>Files:</strong> src/repositories/vector_store.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Source Diversity Analysis</div>
                                    <div class="step-description">Assess variety of returned sources</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Unique source count, source distribution
                                        <br/><strong>Analysis:</strong> Over-reliance on single source?
                                        <br/><strong>Files:</strong> src/evaluation/analysis/vector_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">4</div>
                                    <div class="step-name">Phase 3 Step 2: Recall-Aware K Selection</div>
                                    <div class="step-description">Analyze adaptive K value selection</div>
                                    <div class="step-analysis">
                                        <strong>Logic:</strong> Base K (5) + complexity bonus (0-5) = final K (3-20)
                                        <br/><strong>Metrics:</strong> K variation by category, effectiveness
                                        <br/><strong>Files:</strong> src/services/chat.py (_estimate_recall_requirement)
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                LLM Response Analyses
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Response Length Analysis</div>
                                    <div class="step-description">Measure response completeness via length</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Avg length (chars), distribution (short/medium/long)
                                        <br/><strong>Thresholds:</strong> Too short &lt; 50 chars (error)
                                        <br/><strong>Files:</strong> src/evaluation/analysis/vector_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Response Completeness Analysis</div>
                                    <div class="step-description">Assess whether answer addresses query fully</div>
                                    <div class="step-analysis">
                                        <strong>Checks:</strong> Complete/Incomplete/Declined categories
                                        <br/><strong>Metrics:</strong> % complete answers, % declined
                                        <br/><strong>Files:</strong> src/evaluation/analysis/vector_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Confidence Indicators Analysis</div>
                                    <div class="step-description">Detect hedging language and confidence</div>
                                    <div class="step-analysis">
                                        <strong>Hedging:</strong> "might", "possibly", "unclear" patterns
                                        <br/><strong>Confident:</strong> Direct statements vs uncertain language
                                        <br/><strong>Files:</strong> src/evaluation/analysis/vector_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">4</div>
                                    <div class="step-name">Citation Quality Analysis</div>
                                    <div class="step-description">Track whether responses cite sources</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> % with citations, avg citations/response
                                        <br/><strong>Quality:</strong> Citations relevant to response?
                                        <br/><strong>Files:</strong> src/evaluation/analysis/vector_quality_analysis.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">5</div>
                                    <div class="step-name">RAGAS Evaluation Metrics</div>
                                    <div class="step-description">Advanced NLP-based quality measurement</div>
                                    <div class="step-analysis">
                                        <strong>RAGAS Metrics:</strong>
                                        <br/>‚Ä¢ Faithfulness: Does answer match sources?
                                        <br/>‚Ä¢ Answer Relevancy: Does it answer the query?
                                        <br/>‚Ä¢ Context Precision: Is retrieved context relevant?
                                        <br/>‚Ä¢ Context Recall: Did we retrieve all needed info?
                                        <br/><strong>Files:</strong> src/evaluation/runners/evaluate_ragas.py
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Routing & Fallback Analyses
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">Routing Distribution Analysis</div>
                                    <div class="step-description">Track which routing paths queries take</div>
                                    <div class="step-analysis">
                                        <strong>Routes:</strong> SQL_ONLY, VECTOR_ONLY, HYBRID, UNCERTAIN
                                        <br/><strong>Metrics:</strong> Count and % of each route
                                        <br/><strong>Files:</strong> src/evaluation/runners/run_hybrid_evaluation.py
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Fallback Pattern Analysis</div>
                                    <div class="step-description">Track how often queries fall back to vector search</div>
                                    <div class="step-analysis">
                                        <strong>Triggers:</strong> SQL error, empty results, LLM "cannot find"
                                        <br/><strong>Metrics:</strong> Fallback rate by category
                                        <br/><strong>Files:</strong> src/evaluation/analysis/sql_quality_analysis.py
                                    </d>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Error Taxonomy Analysis</div>
                                    <div class="step-description">Categorize errors by type for debugging</div>
                                    <div class="step-analysis">
                                        <strong>Categories:</strong> LLM declined, Syntax error, Empty response
                                        <br/><strong>Analysis:</strong> Which error type is most common?
                                        <br/><strong>Files:</strong> src/evaluation/analysis/sql_quality_analysis.py
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Performance & Efficiency Analyses
                            </div>
                            <div class="step-list">
                                <div class="step">
                                    <div class="step-number">1</div>
                                    <div class="step-name">End-to-End Query Time Analysis</div>
                                    <div class="step-description">Measure total processing time from user input to response</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> Avg time (ms), percentiles (p50/p95/p99)
                                        <br/><strong>Breakdown:</strong> By routing type and category
                                        <br/><strong>Files:</strong> src/evaluation/runners/*
                                    </div>
                                </div>
                                <div class="step">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Latency by Routing Type</div>
                                    <div class="step-description">Compare performance of SQL vs Vector vs Hybrid</div>
                                    <div class="step-analysis">
                                        <strong>Comparison:</strong> SQL fastest, Hybrid slowest (combines both)
                                        <br/><strong>Metrics:</strong> Latency distribution per route
                                        <br/><strong>Files:</strong> src/evaluation/runners/*
                                    </d>
                                </div>
                                <div class="step">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Category-Specific Performance</div>
                                    <div class="step-description">Analyze performance by query category</div>
                                    <div class="step-analysis">
                                        <strong>Categories:</strong> Simple, Complex, Conversational, Noisy
                                        <br/><strong>Metrics:</strong> Success rate, latency, quality scores by category
                                        <br/><strong>Files:</strong> src/evaluation/runners/*
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Evaluation & Quality Metrics
                            </div>
                            <div class="step-list">
                                <div class="step quality-metric">
                                    <div class="step-number">1</div>
                                    <div class="step-name">SQL Evaluation Metrics</div>
                                    <div class="step-description">Comprehensive evaluation of SQL evaluation results</div>
                                    <div class="step-analysis">
                                        <strong>Results:</strong> 48/48 successful (100%), 97.9% classification accuracy
                                        <br/><strong>Metrics:</strong> Query structure, complexity, correctness, column selection
                                        <br/><strong>Files:</strong> src/evaluation/runners/run_sql_evaluation.py
                                    </d>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">2</div>
                                    <div class="step-name">Vector Evaluation Metrics</div>
                                    <div class="step-description">Comprehensive evaluation of vector search quality</div>
                                    <div class="step-analysis">
                                        <strong>Metrics:</strong> RAGAS scores (Faithfulness, Answer Relevancy, Context)
                                        <br/><strong>Analysis:</strong> Per-category breakdown, source quality
                                        <br/><strong>Files:</strong> src/evaluation/runners/run_vector_evaluation.py
                                    </d>
                                </div>
                                <div class="step quality-metric">
                                    <div class="step-number">3</div>
                                    <div class="step-name">Hybrid Evaluation Metrics</div>
                                    <div class="step-description">Combined SQL + Vector integration quality</div>
                                    <div class="step-analysis">
                                        <strong>Results:</strong> 88% success on 50 test cases
                                        <br/><strong>Metrics:</strong> Routing analysis, data integration quality
                                        <br/><strong>Files:</strong> src/evaluation/runners/run_hybrid_evaluation.py
                                    </d>
                                </div>
                                <div class="step">
                                    <div class="step-number">4</div>
                                    <div class="step-name">Code Coverage Analysis</div>
                                    <div class="step-description">Measure test coverage by module (3-tier hierarchy)</div>
                                    <div class="step-analysis">
                                        <strong>Tiers:</strong>
                                        <br/>‚Ä¢ Tier 1 (Critical): services, api, core ‚â•77%
                                        <br/>‚Ä¢ Tier 2 (Standard): pipeline, evaluation ‚â•24%
                                        <br/>‚Ä¢ Tier 3 (Best effort): ui (excluded, requires live browser)
                                        <br/><strong>Current:</strong> 78.5% overall
                                    </d>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DECISIONS TAB -->
                <div id="decisions-tab" class="view-tab hidden">
                    <div class="section">
                        <div class="section-title">üéØ Key Decision Points & Logic</div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Decision 1: Query Classification Routing
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">Decision</div>
                                    <div class="step-name">Should query be handled by SQL, Vector, or Both?</div>
                                    <div class="step-analysis">
                                        <strong>Decision Logic:</strong>
                                        <br/>1. Pattern matching ‚Üí Preliminary classification (0-1 confidence)
                                        <br/>2. LLM classification ‚Üí Detailed analysis (0-1 confidence)
                                        <br/>3. Threshold routing:
                                        <br/>   ‚Ä¢ confidence ‚â• 0.80: SQL_ONLY
                                        <br/>   ‚Ä¢ confidence 0.75-0.79: CONTEXTUAL (Vector)
                                        <br/>   ‚Ä¢ confidence 0.50-0.74: HYBRID (Both)
                                        <br/>   ‚Ä¢ confidence &lt; 0.50: UNCERTAIN (Vector + fallback)
                                        <br/><strong>Impact:</strong> Determines which data sources and processing pipeline
                                    </d>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Decision 2: SQL Fallback Logic
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">Decision</div>
                                    <div class="step-name">Should we retry with Vector search if SQL fails?</div>
                                    <div class="step-analysis">
                                        <strong>Fallback Triggers:</strong>
                                        <br/>1. SQL Syntax Error ‚Üí Fallback to Vector
                                        <br/>2. SQL Execution Error ‚Üí Fallback to Vector
                                        <br/>3. Empty Results (0 rows) ‚Üí Fallback to Vector
                                        <br/>4. LLM Response "I cannot find this" ‚Üí Fallback to Vector
                                        <br/><strong>Impact:</strong> Provides user with answer even if SQL fails
                                        <br/><strong>Retry Limit:</strong> Max 1 fallback attempt to avoid loops
                                    </d>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Decision 3: Document Quality Filtering
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">Decision</div>
                                    <div class="step-name">Should low-quality documents be filtered from results?</div>
                                    <div class="step-analysis">
                                        <strong>Quality Thresholds (Phase 3 Step 1):</strong>
                                        <br/>‚Ä¢ Coherence score ‚â• 0.70 (text quality)
                                        <br/>‚Ä¢ Metadata score ‚â• 0.60 (author, timestamp present)
                                        <br/>‚Ä¢ Authority score applied (Reddit karma)
                                        <br/><strong>Filtering Strategy:</strong>
                                        <br/>‚Ä¢ Apply at query time (not ingestion) for flexibility
                                        <br/>‚Ä¢ Maintain minimum K results even if below threshold
                                        <br/>‚Ä¢ Preserve top sources for context
                                        <br/><strong>Impact:</strong> Improves response quality by excluding noise
                                    </d>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Decision 4: Adaptive K Selection
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">Decision</div>
                                    <div class="step-name">How many sources should we retrieve?</div>
                                    <div class="step-analysis">
                                        <strong>K Selection Logic (Phase 3 Step 2):</strong>
                                        <br/>1. Assess query complexity: simple/moderate/complex/very_complex
                                        <br/>2. Base K value: 5 (default for most queries)
                                        <br/>3. Complexity bonus: +2-5 for complex queries
                                        <br/>4. Category adjustments: Different for each query type
                                        <br/>5. Final K: 3-20 range
                                        <br/><strong>Impact:</strong> Simple queries get 3-5 sources, complex get 15-20
                                        <br/><strong>Trade-off:</strong> More sources = better coverage but longer context
                                    </d>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Decision 5: Query Expansion
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">Decision</div>
                                    <div class="step-name">Should query be expanded with synonyms?</div>
                                    <div class="step-analysis">
                                        <strong>Expansion Logic (Phase 3 Step 3):</strong>
                                        <br/>1. Contextual/Complex queries: YES expand
                                        <br/>2. SQL queries: NO (exact matching)
                                        <br/>3. Expansion types:
                                        <br/>   ‚Ä¢ Synonyms: "efficient" ‚Üí "PPG/FG%"
                                        <br/>   ‚Ä¢ Entities: "LeBron" ‚Üí "James", "King James"
                                        <br/>   ‚Ä¢ Relationships: "shooting" ‚Üí "FG%, 3P%, FT%"
                                        <br/><strong>Impact:</strong> Finds more relevant documents by synonyms
                                    </d>
                                </div>
                            </div>
                        </div>

                        <div class="subsection">
                            <div class="subsection-title" onclick="toggleSubsection(this)">
                                <span class="toggle-icon">‚ñ∂</span>
                                Decision 6: Response Quality Verification
                            </div>
                            <div class="step-list">
                                <div class="step decision-point">
                                    <div class="step-number">Decision</div>
                                    <div class="step-name">Is the generated response acceptable quality?</div>
                                    <div class="step-analysis">
                                        <strong>Quality Checks:</strong>
                                        <br/>1. Response length ‚â• 50 characters (not empty)
                                        <br/>2. No LLM decline pattern: "I cannot find this information"
                                        <br/>3. Language correctness (English - avoid mixed language issues)
                                        <br/>4. Citation presence (if vector search used)
                                        <br/><strong>If Quality Check Fails:</strong>
                                        <br/>‚Ä¢ Trigger secondary fallback
                                        <br/>‚Ä¢ Switch to different routing strategy
                                        <br/>‚Ä¢ Retry with expanded query
                                    </d>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SIDEBAR -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-title">üìç Quick Navigation</div>
                    <div class="sidebar-item" onclick="scrollToView('overview')">System Overview</div>
                    <div class="sidebar-item" onclick="scrollToView('data-pipeline')">Data Pipeline</div>
                    <div class="sidebar-item" onclick="scrollToView('rag-pipeline')">RAG Query Pipeline</div>
                    <div class="sidebar-item" onclick="scrollToView('analysis')">All Analyses</div>
                    <div class="sidebar-item" onclick="scrollToView('decisions')">Decision Points</div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">üìä Key Metrics</div>
                    <div class="metrics-display">
                        <div class="metric-row">
                            <div class="metric-label">SQL Evaluation:</div>
                            <div class="metric-value">48/48 ‚úì</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">SQL Accuracy:</div>
                            <div class="metric-value">97.9%</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Hybrid Success:</div>
                            <div class="metric-value">88%</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Code Coverage:</div>
                            <div class="metric-value">78.5%</div>
                        </div>
                        <div class="metric-row">
                            <div class="metric-label">Vector Tests:</div>
                            <div class="metric-value">47 cases</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-title">üîë Key Files</div>
                    <div class="sidebar-item">src/data/pipeline.py</div>
                    <div class="sidebar-item">src/services/chat.py</div>
                    <div class="sidebar-item">src/services/query_classifier.py</div>
                    <div class="sidebar-item">src/tools/sql_tool.py</div>
                    <div class="sidebar-item">src/repositories/vector_store.py</div>
                </div>

                <div class="legend">
                    <div class="legend-title">Legend</div>
                    <div class="legend-item">
                        <div class="legend-color color-process"></div>
                        <span>Process/Task</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-decision"></div>
                        <span>Decision Point</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-check"></div>
                        <span>Data Check</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color color-quality"></div>
                        <span>Quality Metric</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Sports_See Complete System Documentation | Interactive Mind Map showing every step, decision point, and analysis</p>
        <p style="margin-top: 10px; opacity: 0.7;">Click on any step to see detailed information. Use tabs to navigate between different pipeline views.</p>
    </div>

    <script>
        function showView(viewName) {
            // Hide all tabs
            document.querySelectorAll('.view-tab').forEach(tab => {
                tab.classList.add('hidden');
            });

            // Show selected tab
            const tab = document.getElementById(`${viewName}-tab`);
            if (tab) {
                tab.classList.remove('hidden');
            }

            // Update active button
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function toggleSubsection(element) {
            const subsection = element.parentElement;
            subsection.classList.toggle('collapsed');
        }

        function scrollToView(viewId) {
            // Trigger view switch
            const view = viewId.replace('scroll-to-', '');
            const parts = viewId.split('-');
            const viewName = parts.join('-');

            const buttons = document.querySelectorAll('.nav-btn');
            for (let btn of buttons) {
                if (btn.textContent.includes(viewId.replace('-', ' '))) {
                    btn.click();
                    break;
                }
            }
        }

        // Add click handler for steps to show detail panel
        document.querySelectorAll('.step').forEach(step => {
            step.addEventListener('click', function(e) {
                // Remove active from other steps
                document.querySelectorAll('.step').forEach(s => {
                    if (s !== this) s.classList.remove('active');
                });
                // Toggle active on this step
                this.classList.toggle('active');
            });
        });

        // Initialize with first subsection expanded
        document.querySelectorAll('.subsection').forEach((subsection, index) => {
            if (index > 0) {
                subsection.classList.add('collapsed');
            }
        });
    </script>
</body>
</html>
